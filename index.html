<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIGRANT 56 GLOCAL</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { max-width: 800px; width: 100%; background: white; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* í—¤ë” */
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 1.5rem; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ (ë‚ ì§œ/ë¼ë‹ˆ) */
        .controls { padding: 15px; background: #eff6ff; display: flex; gap: 10px; justify-content: center; align-items: center; border-bottom: 1px solid #e5e7eb; }
        select { padding: 8px 12px; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 1rem; }
        
        /* ë³¸ë¬¸ (ì„±ê²½ êµ¬ì ˆ) */
        .verse-box { padding: 30px 20px; text-align: center; min-height: 150px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .verse-kr { font-size: 1.4rem; font-weight: bold; color: #1e293b; margin-bottom: 15px; word-break: keep-all; line-height: 1.5; }
        .verse-foreign { font-size: 1.2rem; color: #475569; font-style: italic; min-height: 1.2em; word-break: keep-all; }

        /* ì–¸ì–´ ì„ íƒ ê·¸ë¦¬ë“œ */
        .lang-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; padding: 20px; background: #f1f5f9; }
        .lang-btn {
            background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 12px;
            cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.2s;
            text-align: left; font-size: 0.9rem; font-weight: 500;
        }
        .lang-btn:hover { border-color: var(--primary); transform: translateY(-2px); }
        .lang-btn.playing { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 12px rgba(37,99,235,0.3); }
        /* í•œêµ­ì–´ ë²„íŠ¼ ê°•ì¡° */
        .lang-btn.kr-btn { border: 2px solid #2563eb; background: #eff6ff; } 
        .flag { font-size: 1.5rem; }
        
        #status { text-align: center; padding: 20px; color: #64748b; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸŒ MIGRANT 56 GLOCAL</h1>
        <p>23ê°œêµ­ ì–¸ì–´ ì„±ê²½ ì•”ì†¡ (V3.1)</p>
    </div>

    <div class="controls">
        <select id="daySelect" onchange="loadVerse()"></select>
        <select id="mealSelect" onchange="loadVerse()">
            <option value="B">ì•„ì¹¨ (Morning)</option>
            <option value="L">ì ì‹¬ (Lunch)</option>
            <option value="D">ì €ë… (Dinner)</option>
        </select>
    </div>

    <div class="verse-box">
        <div class="verse-kr" id="text-ko">ë¡œë”© ì¤‘...</div>
        <div class="verse-foreign" id="text-target">êµ­ê¸°ë¥¼ ëˆ„ë¥´ë©´ ì†Œë¦¬ê°€ ë‚˜ì˜µë‹ˆë‹¤</div>
    </div>

    <div id="status"></div>
    <div class="lang-grid" id="langGrid"></div>
</div>

<script>
    const LANG_INFO = {
        "ko": { flag: "ğŸ‡°ğŸ‡·", name: "í•œêµ­ì–´" },
        "en": { flag: "ğŸ‡ºğŸ‡¸", name: "English" },
        "zh": { flag: "ğŸ‡¨ğŸ‡³", name: "ä¸­æ–‡ (ì¤‘êµ­)" },
        "vi": { flag: "ğŸ‡»ğŸ‡³", name: "Tiáº¿ng Viá»‡t" },
        "th": { flag: "ğŸ‡¹ğŸ‡­", name: "Thai" },
        "id": { flag: "ğŸ‡®ğŸ‡©", name: "Indonesia" },
        "tl": { flag: "ğŸ‡µğŸ‡­", name: "Tagalog" },
        "mn": { flag: "ğŸ‡²ğŸ‡³", name: "Mongolia" },
        "si": { flag: "ğŸ‡±ğŸ‡°", name: "Sinhala" },
        "uz": { flag: "ğŸ‡ºğŸ‡¿", name: "Uzbek" },
        "ur": { flag: "ğŸ‡µğŸ‡°", name: "Urdu" },
        "km": { flag: "ğŸ‡°ğŸ‡­", name: "Khmer" },
        "bn": { flag: "ğŸ‡§ğŸ‡©", name: "Bengali" },
        "ky": { flag: "ğŸ‡°ğŸ‡¬", name: "Kyrgyz" },
        "ne": { flag: "ğŸ‡³ğŸ‡µ", name: "Nepali" },
        "my": { flag: "ğŸ‡²ğŸ‡²", name: "Burmese" },
        "lo": { flag: "ğŸ‡±ğŸ‡¦", name: "Lao" },
        "tg": { flag: "ğŸ‡¹ğŸ‡¯", name: "Tajik" },
        "ru": { flag: "ğŸ‡·ğŸ‡º", name: "Russian" },
        "ar": { flag: "ğŸ‡¸ğŸ‡¦", name: "Arabic" },
        "es": { flag: "ğŸ‡ªğŸ‡¸", name: "Spanish" },
        "pt": { flag: "ğŸ‡µğŸ‡¹", name: "Portuguese" },
        "fr": { flag: "ğŸ‡«ğŸ‡·", name: "French" }
    };

    let globalData = null;
    let currentAudio = null;

    fetch('audio/index.json')
        .then(res => res.json())
        .then(data => {
            globalData = data;
            initDaySelect();
            loadVerse();
            document.getElementById('status').style.display = 'none';
        })
        .catch(err => {
            document.getElementById('status').innerHTML = "âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            console.error(err);
        });

    function initDaySelect() {
        const days = [...new Set(globalData.files.map(f => f.day))];
        const daySelect = document.getElementById('daySelect');
        daySelect.innerHTML = days.map(d => `<option value="${d}">Day ${d}</option>`).join('');
    }

    function loadVerse() {
        if (!globalData) return;
        
        const day = parseInt(document.getElementById('daySelect').value);
        const meal = document.getElementById('mealSelect').value;
        const item = globalData.files.find(f => f.day === day && f.meal === meal);
        
        if (!item) return;

        document.getElementById('text-ko').innerText = item.texts['ko'] || "";
        document.getElementById('text-target').innerText = "êµ­ê¸°ë¥¼ ëˆ„ë¥´ë©´ ì†Œë¦¬ê°€ ë‚˜ì˜µë‹ˆë‹¤";

        const grid = document.getElementById('langGrid');
        grid.innerHTML = "";

        // ì´ì œ í•œêµ­ì–´ë„ í¬í•¨í•´ì„œ ëª¨ë“  ë²„íŠ¼ì„ ë§Œë“­ë‹ˆë‹¤
        Object.keys(item.audio).forEach(lang => {
            const info = LANG_INFO[lang] || { flag: "ğŸ³ï¸", name: lang };
            const btn = document.createElement('div');
            btn.className = 'lang-btn';
            if (lang === 'ko') btn.classList.add('kr-btn'); // í•œêµ­ì–´ ë²„íŠ¼ íŠ¹ë³„ í‘œì‹œ
            
            btn.innerHTML = `<span class="flag">${info.flag}</span><span>${info.name}</span>`;
            
            btn.onclick = () => {
                playAudio(item.audio[lang], item.texts[lang], btn);
            };
            grid.appendChild(btn);
        });
    }

    function playAudio(path, text, btnElement) {
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
        }
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('playing'));

        // í…ìŠ¤íŠ¸ í‘œì‹œ
        document.getElementById('text-target').innerText = text;

        const fullPath = "audio/" + path;
        currentAudio = new Audio(fullPath);
        btnElement.classList.add('playing');
        
        currentAudio.play().catch(e => alert("ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜: " + e));
        
        currentAudio.onended = () => {
            btnElement.classList.remove('playing');
        };
    }
</script>

</body>
</html>